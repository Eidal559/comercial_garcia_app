<!DOCTYPE html>
<html lang="es">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comercial Garc√≠a - Sistema de Inventario</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<script src="js/validation-utils.js"></script>
   <script src="js/security-utils.js"></script>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ Comercial Garc√≠a</h1>
            <p>Sistema de Inventario - Simple, R√°pido, Confiable</p>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä Panel Principal</button>
            <button class="nav-btn" onclick="showSection('add-product')">‚ûï Agregar Producto</button>
            <button class="nav-btn" onclick="showSection('inventory')">üì¶ Ver Inventario</button>
            <button class="nav-btn" onclick="showSection('sell')">üí∞ Vender</button>
            <button class="nav-btn" onclick="showSection('restock')">üìà Reabastecer</button>
            <button class="nav-btn" onclick="showSection('barcode')">üì± C√≥digo de Barras</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-products">0</div>
                    <div class="stat-label">Total Productos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="low-stock-count">0</div>
                    <div class="stat-label">Stock Bajo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-value">$0</div>
                    <div class="stat-label">Valor Total Inventario</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="categories-count">0</div>
                    <div class="stat-label">Categor√≠as</div>
                </div>
            </div>
            
            <div id="low-stock-alerts"></div>
        </div>

        <!-- Add Product Section -->
        <div id="add-product" class="section">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">Agregar Nuevo Producto</h2>
            <form id="add-product-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="sku">SKU (C√≥digo de Producto)</label>
                        <input type="text" id="sku" required>
                    </div>
                    <div class="form-group">
                        <label for="barcode">C√≥digo de Barras</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="barcode" placeholder="Opcional">
                            <button type="button" class="btn" onclick="scanBarcodeForAdd()">üì± Escanear</button>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Nombre del Producto</label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="category">Categor√≠a</label>
                        <select id="category" required>
                            <option value="">Seleccionar Categor√≠a</option>
                            <option value="Tornillos">Tornillos</option>
                            <option value="Herramientas">Herramientas</option>
                            <option value="Pinturas">Pinturas</option>
                            <option value="Ferreter√≠a">Ferreter√≠a</option>
                            <option value="El√©ctrico">El√©ctrico</option>
                            <option value="Plomer√≠a">Plomer√≠a</option>
                            <option value="Jard√≠n">Jard√≠n</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="price">Precio ($)</label>
                        <input type="number" id="price" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Cantidad Inicial</label>
                        <input type="number" id="quantity" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="min-stock">Alerta Stock M√≠nimo</label>
                        <input type="number" id="min-stock" min="0" value="5">
                    </div>
                    <div class="form-group">
                        <label for="supplier">Proveedor (Opcional)</label>
                        <input type="text" id="supplier" placeholder="Nombre del proveedor">
                    </div>
                </div>
                <button type="submit" class="btn">Agregar Producto</button>
            </form>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #2c3e50; margin: 0;">Gesti√≥n de Inventario</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="exportData()">üì§ Exportar</button>
                    <label for="import-file" class="btn" style="margin: 0; cursor: pointer;">üì• Importar</label>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
            
            <input type="text" id="search" class="search-bar" placeholder="üîç Buscar por SKU, nombre, categor√≠a o c√≥digo de barras...">
            
            <div style="margin-bottom: 20px;">
                <select id="category-filter" onchange="filterInventory()">
                    <option value="">Todas las Categor√≠as</option>
                </select>
            </div>

            <div style="overflow-x: auto;">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Nombre / C√≥digo de Barras</th>
                            <th>Categor√≠a</th>
                            <th>Precio</th>
                            <th>Cantidad</th>
                            <th>Stock M√≠n</th>
                            <th>Valor</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-body">
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 20px; text-align: center; color: #7f8c8d;">
                <p><strong>Atajos de teclado:</strong> Ctrl+1 (Panel), Ctrl+2 (Agregar), Ctrl+3 (Inventario), Ctrl+4 (Vender), Ctrl+5 (Reabastecer), Ctrl+6 (C√≥digo de Barras)</p>
            </div>
        </div>

        <!-- Sell Item Section -->
        <div id="sell" class="section">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">Vender Producto</h2>
            <form id="sell-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="sell-sku">SKU, C√≥digo de Barras o Nombre</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="sell-sku" placeholder="Buscar producto" required>
                            <button type="button" class="btn" onclick="scanBarcodeForSell()">üì± Escanear</button>
                        </div>
                        <div id="search-suggestions" style="background: white; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="sell-quantity">Cantidad a Vender</label>
                        <input type="number" id="sell-quantity" min="1" required>
                    </div>
                </div>
                <div id="product-info" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; display: none;">
                    <h3>Detalles del Producto:</h3>
                    <p id="product-details"></p>
                </div>
                <button type="submit" class="btn">Completar Venta</button>
            </form>
        </div>

        <!-- Restock Section -->
        <div id="restock" class="section">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">Reabastecer Productos</h2>
            <form id="restock-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="restock-sku">SKU, C√≥digo de Barras o Nombre</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="restock-sku" placeholder="Buscar producto" required>
                            <button type="button" class="btn" onclick="scanBarcodeForRestock()">üì± Escanear</button>
                        </div>
                        <div id="restock-suggestions" style="background: white; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="restock-quantity">Cantidad a Agregar</label>
                        <input type="number" id="restock-quantity" min="1" required>
                    </div>
                </div>
                <div id="restock-product-info" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; display: none;">
                    <h3>Detalles del Producto:</h3>
                    <p id="restock-product-details"></p>
                </div>
                <button type="submit" class="btn">Agregar Stock</button>
            </form>
        </div>

        <!-- Barcode Scanner Section -->
        <div id="barcode" class="section">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">Esc√°ner de C√≥digo de Barras</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div>
                    <h3 style="margin-bottom: 15px;">B√∫squeda R√°pida</h3>
                    <div class="form-group">
                        <label for="barcode-search">C√≥digo de Barras</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="barcode-search" placeholder="Escanear o ingresar c√≥digo">
                            <button type="button" class="btn" onclick="startBarcodeScanning()">üì± Iniciar Esc√°ner</button>
                        </div>
                    </div>
                    <button type="button" class="btn" onclick="searchByBarcode()">üîç Buscar Producto</button>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 15px;">Venta R√°pida</h3>
                    <div class="form-group">
                        <label for="quick-barcode">C√≥digo de Barras</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="quick-barcode" placeholder="Escanear producto">
                            <button type="button" class="btn" onclick="startQuickSaleScanning()">üì± Escanear</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="quick-quantity">Cantidad</label>
                        <input type="number" id="quick-quantity" value="1" min="1">
                    </div>
                    <button type="button" class="btn" onclick="quickSale()">‚ö° Venta R√°pida</button>
                </div>
            </div>

            <!-- Camera Scanner -->
            <div id="camera-container" style="display: none; text-align: center; margin: 20px 0;">
                <h3>Esc√°ner de C√°mara</h3>
                <video id="barcode-video" style="width: 100%; max-width: 500px; border: 2px solid #3498db; border-radius: 10px;"></video>
                <div style="margin: 10px 0;">
                    <button type="button" class="btn btn-danger" onclick="stopBarcodeScanning()">Detener Esc√°ner</button>
                </div>
                <canvas id="barcode-canvas" style="display: none;"></canvas>
            </div>

            <div id="barcode-result" style="margin: 20px 0;"></div>
        </div>

        <div id="alerts"></div>
    </div>

    <!-- Scripts -->
    <script src="js/database.js"></script>
    <script src="js/barcode-scanner.js"></script>
    <script src="js/inventory-manager.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/app.js"></script>
</body>
</html>